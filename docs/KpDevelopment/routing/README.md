---
title:路由
---

# 路由

## 后端路由
路由这个概念最先是后端出现的。

在开发页面时，经常会看到这样`http://hometown.xxx.edu.cn/bbs/forum.php`有时还会有带`.asp`或`.html`的路径。这就是所谓的SSR(Server Side Render)。**通过服务端渲染，直接返回页面**。

其响应过程是这样的
1. 浏览器发出请求
2. 服务器监听到80端口（或443）有请求过来，并解析url路径
3. 根据服务器的路由配置，返回相应信息（可以是 html 字串，也可以是 json 数据，图片等）
4. 浏览器根据数据包的`Content-Type`来决定如何解析数据简单来说路由就是用来跟后端服务器进行交互的一种方式，通过不同的路径，来请求不同的资源，请求不同的页面是路由的其中一种功能。
5. 如果你熟悉node.js那么会对后端路由很熟悉，根据浏览器发过来的url来返回不同页面

## AJAX

Ajax，全称 Asynchronous JavaScript And XML，是浏览器用来实现异步加载的一种技术方案。在 90s 年代初，大多数的网页都是通过直接返回 HTML 的，用户的每次更新操作都需要重新刷新页面。有了 Ajax 后，用户交互就不用每次都刷新页面，体验带来了极大的提升。

## SPA

单页应用不仅仅是在页面交互是无刷新的，连页面跳转都是无刷新的，为了实现单页应用，所以就有了前端路由。这就是为什么这篇博客要写到React开发里。（这里刷新的概念就是重新向服务端请求）

## 前端路由

本质上就是检测 url 的变化，截获 url 地址，然后解析来匹配路由规则。重点在于截获两个字，要做到 url 改变但是不向服务端发请求页面不刷新。

三种实现方式：hash，history，memory

## hash路由-旧时代的残党
url hash 就是类似于`https://juejin.im/post/5e7496c6f265da57701455d5#articleHeader2`，hash 值的变化，并不会导致浏览器向服务器发出请求，浏览器不发出请求，也就不会刷新页面。另外每次 hash 值的变化，还会触发 `hashchange` 这个事件，通过这个事件我们就可以知道 hash 值发生了哪些变化。

hash 的实现相对来说要简单方便些，而且不用服务器来支持。因为#本身就不会向服务端发请求。

检测到 hash 的变化后，就可以通过替换 DOM 的方式来实现页面的更换。前端路由只是局部重新渲染而已。

1. 监听 hashchange
2. 每当 hash 变化时就解析路径
3. 匹配路由根据我们的路由（if else）局部渲染

缺点：有点丑

## history路由—新时代的船
history —— 利用了 HTML5 History Interface 中新增的 pushState() 和 replaceState() 方法。（需要特定浏览器支持）添加新记录后，浏览器地址栏**立刻显示**example.com/2.html，但并不会跳转到2.html，甚至也不会检查2.html是否存在，它只是成为浏览历史中的最新记录。

每当同一个文档的浏览历史（即history对象）出现变化时，就会触发popstate事件。仅仅调用pushState()方法或replaceState()方法 ，并不会触发该事件，只有用户点击浏览器倒退按钮和前进按钮，或者使用 JavaScript 调用History.back()、History.forward()、History.go()方法时才会触发。

history三种跳转方式：
1. pushState()
2. 通过浏览器历史返回(用户点击/History.xxx)-触发 popState 事件
3. 地址栏用户亲自输入-向服务端发起请求服务器做重定向

## 小结
* 只要做到我们用JS代码的①局部渲染②代替页面的整体刷新就OK，不刷新靠语言特性，局部渲染靠程序员
* hash 在 hashchange 事件做到局部渲染
* history 复杂一点因为有三种情况①pushState()代码后②popState事件③需要服务器将所有前端路由都渲染同一页面(重定向)不跳转而靠我们局部渲染